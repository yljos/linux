select: &select {type: select, exclude-filter: "(?i).*(kr|tw|Traffic|Expire|官网|0\\.[0-9]|剩余|到期).*", include-all-proxies: true}
fallback: &fallback {type: fallback, url: "https://www.gstatic.com/generate_204", interval: 30, hidden: true, timeout: 600, max-failed-times: 3, include-all-proxies: true, exclude-filter: "(?i).*(kr|tw|Traffic|Expire|官网|0\\.[0-9]|剩余|到期).*"}
load-balance: &load-balance {type: load-balance, strategy: consistent-hashing, url: "https://www.gstatic.com/generate_204", interval: 30, hidden: true, timeout: 600, max-failed-times: 3, include-all-proxies: true, exclude-filter: "(?i).*(kr|tw|Traffic|Expire|官网|0\\.[0-9]|剩余|到期).*"}
url-test: &url-test {type: url-test, url: "https://www.gstatic.com/generate_204", interval: 30, tolerance: 300, hidden: true, timeout: 600, max-failed-times: 3, include-all-proxies: true, exclude-filter: "(?i).*(kr|tw|Traffic|Expire|官网|0\\.[0-9]|剩余|到期).*"}
domain: &domain {proxy: M, interval: 86400, type: http, format: mrs, behavior: domain}
ipcidr: &ipcidr {proxy: M, interval: 86400, type: http, format: mrs, behavior: ipcidr}
classical: &classical {proxy: M, type: http, interval: 86400, behavior: classical, format: yaml}
mixed-port: 12138
redir-port: 7892
tproxy-port: 7893
allow-lan: true
bind-address: "*"
find-process-mode: strict # always, strict, off
log-level: error # info, warning, error, debug
ipv6: true
udp: true
unified-delay: true
tcp-concurrent: true
profile: {store-selected: false, store-fake-ip: true}
external-controller: "0.0.0.0:9090"
secret: "101300"
authentication: ["huai:password12138"]
skip-auth-prefixes: [127.0.0.1/8, 192.168.0.0/16]
external-ui: ui
global-client-fingerprint: firefox
external-ui-url: "https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/yacd.zip"
sniffer: {enable: true, force-dns-mapping: true, parse-pure-ip: true, override-destination: true, sniff: {TLS: {ports: [443, 8443]}, HTTP: {ports: [80, "8080-8880"], override-destination: true}}, skip-domain: ["Mijia Cloud", "dlg.io.mi.com"]}
tun: {enable: false, device: clash, stack: system, dns-hijack: [0.0.0.0:53], auto-route: true, udp-timeout: 60, mtu: 1500, auto-detect-interface: true, auto-redirect: true, strict-route: true, endpoint-independent-nat: true}
hosts: {"homeassistant.local": 192.168.31.21, "nas.lan": 192.168.31.21, "openwrt.lan": 192.168.31.1, "ax6s.lan": 192.168.31.2, "huai-PC.lan": 192.168.31.15}
dns:
  enable: true
  prefer-h3: false
  listen: "0.0.0.0:1053"
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter-mode: blacklist
  fake-ip-filter: ["+.lan", "+.local", "localhost.ptlogin2.qq.com", "+.msftconnecttest.com", "+.msftncsi.com", "+.googleapis.com", "+.googleapis.cn", "alt7-mtalk.google.com", "alt8-mtalk.google.com", "mtalk-dev.google.com", "mtalk-staging.google.com", "mtalk4.google.com", "alt1-mtalk.google.com", "alt2-mtalk.google.com", "alt3-mtalk.google.com", "alt4-mtalk.google.com", "alt5-mtalk.google.com", "alt6-mtalk.google.com", "mtalk.google.com"]
  use-hosts: true
  default-nameserver: ["223.5.5.5#DIRECT"]
  proxy-server-nameserver: ["https://dns.alidns.com/dns-query#DIRECT"]
  nameserver: ["https://cloudflare-dns.com/dns-query#M"]
  direct-nameserver: ["https://dns.alidns.com/dns-query#DIRECT"]
  nameserver-policy:
    "rule-set:microsoft": "https://cloudflare-dns.com/dns-query#Microsoft"
    # "rule-set:ad-site-classical": "rcode://refused"
    "rule-set:openai": "https://cloudflare-dns.com/dns-query#M"
    "rule-set:github": "https://cloudflare-dns.com/dns-query#GitHub"
    "rule-set:telegram-site": "https://cloudflare-dns.com/dns-query#Telegram"
    "rule-set:twitter": "https://cloudflare-dns.com/dns-query#US_fallback"
    "rule-set:facebook": "https://cloudflare-dns.com/dns-query#US_fallback"
    "rule-set:tiktok": "https://cloudflare-dns.com/dns-query#JP_fallback"
    "rule-set:netflix": "https://cloudflare-dns.com/dns-query#Netflix"
    "rule-set:youtube": "https://dns.google/dns-query#Google"
    "rule-set:googlefcm": "https://dns.google/dns-query#Google"
    "rule-set:google": "https://dns.google/dns-query#Google"
    "rule-set:speedtest-site": "https://cloudflare-dns.com/dns-query#M"
proxies: []
proxy-groups:
  - {<<: *select, name: M, proxies: [JP_fallback, US_fallback, SG_fallback, HK_fallback, DIRECT]}
  - {<<: *select, name: Default, type: select, proxies: [M, JP_fallback, US_fallback, SG_fallback, HK_fallback, DIRECT]}
  - {<<: *select, name: Google, proxies: [JP_fallback, US_fallback, SG_fallback, HK_fallback]}
  - {<<: *select, name: Telegram, proxies: [JP_fallback, US_fallback, SG_fallback, HK_fallback]}
  - {<<: *select, name: Netflix, proxies: [SG_fallback, JP_fallback, US_fallback, HK_fallback]}
  - {<<: *select, name: PikPak, proxies: [HK_fallback, SG_fallback, JP_fallback, US_fallback]}
  - {<<: *select, name: GitHub, proxies: [JP_fallback, SG_fallback, US_fallback, HK_fallback, DIRECT]}
  - {<<: *select, name: Microsoft, proxies: [JP_fallback, SG_fallback, HK_fallback, DIRECT, US_fallback]}
  - {<<: *fallback, name: JP_fallback, filter: "(?i)(日本|jp|japan)"}
  - {<<: *fallback, name: US_fallback, filter: "(?i)(美国|us|united|america)"}
  - {<<: *fallback, name: SG_fallback, filter: "(?i)(新加坡|sg|singapore)"}
  - {<<: *fallback, name: HK_fallback, filter: "(?i)(香港|hk|hongkong)"}
rule-providers:
  adguard: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/adguard.mrs}
  # ad-site-classical: { <<: *classical, url: https://github.com/yljos/rule-set/raw/refs/heads/main/clash/ad/ad-site-classical.yaml }
  ad-ip: {<<: *ipcidr, url: https://github.com/yljos/rule-set/raw/refs/heads/main/clash/ad/ad-ip.mrs}
  alibaba-site: {<<: *domain, url: https://github.com/yljos/rule-set/raw/refs/heads/main/clash/alibaba/alibaba-site.mrs}
  alibaba-ip: {<<: *ipcidr, url: https://github.com/yljos/rule-set/raw/refs/heads/main/clash/alibaba/alibaba-ip.mrs}
  apkpure: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/apkpure.mrs}
  cloudflare: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/cloudflare.mrs}
  cloudflare-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/cloudflare.mrs}
  cn-site: {<<: *domain, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/cn/cn-site.mrs}
  cn-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/cn/cn-ip.mrs}
  direct-site: {<<: *domain, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/direct/direct-site.mrs}
  direct-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/direct/direct-ip.mrs}
  mozilla: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/mozilla.mrs}
  gfw-site: {<<: *domain, url: https://github.com/yljos/rule-set/raw/refs/heads/main/clash/gfw/gfw-site.mrs}
  github: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/github.mrs}
  google: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/google.mrs}
  google-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/google.mrs}
  googlefcm: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/googlefcm.mrs}
  jd: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/jd.mrs}
  local-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/local/local-ip.mrs}
  microsoft: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/microsoft.mrs}
  netflix: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/netflix.mrs}
  netflix-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/netflix.mrs}
  openai: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/openai.mrs}
  pikpak-site: {<<: *domain, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash//pikpak/pikpak-site.mrs}
  pikpak-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/pikpak/pikpak-ip.mrs}
  proxy-site: {<<: *domain, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/proxy/proxy-site.mrs}
  speedtest-site: {<<: *domain, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/speedtest/speedtest-site.mrs}
  spotify: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/spotify.mrs}
  telegram-site: {<<: *domain, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/telegram/telegram-site.mrs}
  telegram-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/yljos/rule-set/refs/heads/main/clash/telegram/telegram-ip.mrs}
  tiktok: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/tiktok.mrs}
  twitter: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/twitter.mrs}
  twitter-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/twitter.mrs}
  wikimedia: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/wikimedia.mrs}
  youtube: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/youtube.mrs}
  f-droid: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/f-droid.mrs}
  tencent: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/tencent.mrs}
  facebook: {<<: *domain, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/facebook.mrs}
  facebook-ip: {<<: *ipcidr, url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geoip/facebook.mrs}
rules:
  - "AND,((DST-PORT,443/8443),(NETWORK,UDP)),REJECT"
  - "PROCESS-NAME,com.eg.android.AlipayGphone,DIRECT"
  - "PROCESS-NAME,com.whmstr.whsmk,DIRECT"
  # - "RULE-SET,ad-site-classical,REJECT"
  - "RULE-SET,ad-ip,REJECT"
  - "RULE-SET,cloudflare,M"
  - "DOMAIN-KEYWORD,msftconnecttest.com,Microsoft"
  - "DOMAIN-KEYWORD,msftncsi.com,Microsoft"
  - "DOMAIN-KEYWORD,googleapis,Google"
  - "RULE-SET,direct-site,DIRECT"
  - "RULE-SET,pikpak-site,PikPak"
  - "RULE-SET,alibaba-site,DIRECT"
  - "RULE-SET,jd,DIRECT"
  - "RULE-SET,tencent,DIRECT"
  - "RULE-SET,googlefcm,DIRECT"
  - "RULE-SET,proxy-site,M"
  - "RULE-SET,github,GitHub"
  - "RULE-SET,mozilla,M"
  - "RULE-SET,microsoft,Microsoft"
  - "RULE-SET,openai,M"
  - "RULE-SET,youtube,Google"
  - "RULE-SET,google,Google"
  - "RULE-SET,netflix,Netflix"
  - "RULE-SET,tiktok,JP_fallback"
  - "RULE-SET,telegram-site,Telegram"
  - "RULE-SET,twitter,US_fallback"
  - "RULE-SET,facebook,US_fallback"
  - "RULE-SET,adguard,M"
  - "RULE-SET,speedtest-site,M"
  - "RULE-SET,wikimedia,M"
  - "RULE-SET,apkpure,M"
  - "RULE-SET,f-droid,M"
  - "RULE-SET,spotify,M"
  - "RULE-SET,gfw-site,M"
  - "RULE-SET,cn-site,DIRECT"
  # ipcidr
  - "RULE-SET,local-ip,DIRECT"
  - "RULE-SET,direct-ip,DIRECT"
  - "RULE-SET,cloudflare-ip,M"
  - "RULE-SET,pikpak-ip,PikPak"
  - "RULE-SET,alibaba-ip,DIRECT"
  - "RULE-SET,telegram-ip,Telegram"
  - "RULE-SET,twitter-ip,US_fallback"
  - "RULE-SET,facebook-ip,US_fallback"
  - "RULE-SET,netflix-ip,Netflix"
  - "RULE-SET,google-ip,Google"
  - "RULE-SET,cn-ip,DIRECT"
  - "MATCH,Default"

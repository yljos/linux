#!/bin/sh /etc/rc.common

START=99

start() {
    # IPv4 策略路由 [cite: 33, 34]
    ip rule add fwmark 1 table 100 2>/dev/null
    ip route add local default dev lo table 100 2>/dev/null

    # IPv6 策略路由 [cite: 36, 37]
    ip -6 rule add fwmark 1 table 100 2>/dev/null
    ip -6 route add local default dev lo table 100 2>/dev/null
    
    echo "Singbox routing rules applied."
}

stop() {
    # 清理路由 [cite: 42, 44]
    ip rule del fwmark 1 table 100 2>/dev/null
    ip route flush table 100 2>/dev/null
    ip -6 rule del fwmark 1 table 100 2>/dev/null
    ip -6 route flush table 100 2>/dev/null
    
    echo "Singbox routing rules cleared."
}